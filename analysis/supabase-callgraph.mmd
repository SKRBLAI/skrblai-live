graph TD
    %% Supabase Call Graph - SKRBL AI Platform
    
    %% Entry Points
    HomePage["`ðŸ  **app/page.tsx**
    Homepage Entry Point
    Flags: HP_GUIDE_STAR`"]
    
    AgentsPage["`ðŸ¤– **app/agents/page.tsx**
    Agents Page
    Flags: ENABLE_ORBIT`"]
    
    DashboardAnalytics["`ðŸ“Š **app/dashboard/analytics/page.tsx**
    Analytics Dashboard
    âš ï¸ Direct createClient`"]
    
    %% Critical API Routes
    StripeWebhook["`ðŸ’³ **app/api/stripe/webhook/route.ts**
    Stripe Webhook Handler
    ðŸ”’ Admin Access
    âœ… Always Available`"]
    
    CheckoutAPI["`ðŸ›’ **app/api/checkout/route.ts**
    Checkout API
    Flags: ENABLE_STRIPE`"]
    
    ScanAPI["`ðŸ” **app/api/scan/route.ts**
    Business Scan API
    ðŸŒ Anon Access`"]
    
    LeadsAPI["`ðŸ“ **app/api/leads/submit/route.ts**
    Lead Submission
    ðŸŒ Anon Access`"]
    
    HealthAPI["`ðŸ¥ **app/api/health/auth/route.ts**
    Auth Health Check
    ðŸ”’ Admin Access
    âœ… Always Available`"]
    
    FoundersAPI["`ðŸ‘‘ **app/api/founders/redeem/route.ts**
    Founder Code Redemption
    ðŸ”’ Admin Access`"]
    
    %% Canonical Supabase Infrastructure
    SupabaseIndex["`ðŸ“š **lib/supabase/index.ts**
    Canonical Entry Point
    Exports: getBrowserSupabase
    getServerSupabaseAdmin
    getServerSupabaseAnon`"]
    
    SupabaseClient["`ðŸ–¥ï¸ **lib/supabase/client.ts**
    Browser Client Factory
    getBrowserSupabase()`"]
    
    SupabaseServer["`ðŸ–¥ï¸ **lib/supabase/server.ts**
    Server Client Factory
    Admin & Anon Clients`"]
    
    %% Legacy Infrastructure
    LegacyUtils["`âš ï¸ **utils/supabase.ts**
    Legacy Helper
    ðŸš¨ Deprecated`"]
    
    LegacyHelpers["`âš ï¸ **utils/supabase-helpers.ts**
    Legacy Helpers
    ðŸš¨ Deprecated`"]
    
    %% Components
    AdminDashboard["`ðŸŽ›ï¸ **components/admin/AccuracyDashboard.tsx**
    Admin Dashboard
    âš ï¸ Direct createClient`"]
    
    RevenueDashboard["`ðŸ’° **components/admin/RevenueAnalyticsDashboard.tsx**
    Revenue Dashboard
    âš ï¸ Direct createClient
    Flags: ENABLE_ARR_DASH`"]
    
    AgentLeague["`ðŸŒŸ **components/home/AgentLeaguePreview.tsx**
    Agent League Preview
    Flags: HP_GUIDE_STAR`"]
    
    %% Supabase Core
    SupabaseCore["`âš¡ **@supabase/supabase-js**
    createClient()`"]
    
    %% Database Tables
    ProfilesTable["`ðŸ‘¤ **profiles**
    User Management
    ðŸ”’ RLS Enabled`"]
    
    LeadsTable["`ðŸ“‹ **leads**
    Lead Capture
    ðŸ”’ RLS Enabled`"]
    
    SubscriptionsTable["`ðŸ’³ **subscriptions**
    Stripe Integration
    ðŸ”’ RLS Enabled`"]
    
    OrdersTable["`ðŸ›ï¸ **skillsmith_orders**
    Sports Purchases
    ðŸ”’ RLS Enabled`"]
    
    PaymentEventsTable["`ðŸ’° **payment_events**
    Payment Tracking
    ðŸ”’ RLS Enabled`"]
    
    SystemLogsTable["`ðŸ“ **system_logs**
    System Monitoring
    âŒ No RLS`"]
    
    %% Call Flow Connections
    HomePage --> AgentLeague
    
    StripeWebhook --> SupabaseIndex
    ScanAPI --> SupabaseIndex
    LeadsAPI --> SupabaseIndex
    HealthAPI --> SupabaseIndex
    FoundersAPI --> SupabaseIndex
    
    SupabaseIndex --> SupabaseClient
    SupabaseIndex --> SupabaseServer
    
    DashboardAnalytics --> SupabaseCore
    AdminDashboard --> SupabaseCore
    RevenueDashboard --> SupabaseCore
    
    SupabaseClient --> SupabaseCore
    SupabaseServer --> SupabaseCore
    
    LegacyUtils --> SupabaseClient
    LegacyHelpers --> SupabaseClient
    
    %% Database Connections
    SupabaseCore --> ProfilesTable
    SupabaseCore --> LeadsTable
    SupabaseCore --> SubscriptionsTable
    SupabaseCore --> OrdersTable
    SupabaseCore --> PaymentEventsTable
    SupabaseCore --> SystemLogsTable
    
    %% Styling
    classDef entryPoint fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef canonical fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef legacy fill:#fff3e0,stroke:#ef6c00,stroke-width:2px
    classDef critical fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef database fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef external fill:#f5f5f5,stroke:#424242,stroke-width:2px
    
    class HomePage,AgentsPage,DashboardAnalytics entryPoint
    class SupabaseIndex,SupabaseClient,SupabaseServer canonical
    class LegacyUtils,LegacyHelpers legacy
    class StripeWebhook,HealthAPI critical
    class ProfilesTable,LeadsTable,SubscriptionsTable,OrdersTable,PaymentEventsTable,SystemLogsTable database
    class SupabaseCore external